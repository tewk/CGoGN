
IF(WIN32)
    IF(BUILD_SHARED_LIBS)
        ADD_DEFINITIONS(-DNL_EXPORTS)
        ADD_DEFINITIONS(-DNL_SHARED_LIBS)
    ENDIF(BUILD_SHARED_LIBS)
ENDIF(WIN32)

AUX_SOURCE_DIRECTORY(NL SOURCES)

# extensions
IF(USE_CNC)
    AUX_SOURCE_DIRECTORY(plugins/cnc SOURCES)
    set(SOURCES ${SOURCES};plugins/cnc/cnc_cuda_blas.cu)
ENDIF(USE_CNC)

IF(USE_ATLAS)
    ADD_DEFINITIONS(-DNL_USE_ATLAS)
ENDIF(USE_ATLAS)

IF(USE_SUPERLU)
    ADD_DEFINITIONS(-DNL_USE_SUPERLU)
#   SET(SUPERLU_INCS ${SUPERLU_HOME}/SRC)
	INCLUDE_DIRECTORIES(${SUPERLU_INCLUDE_DIRS})
ENDIF(USE_SUPERLU)

IF(USE_CHOLMOD)
	IF (APPLE)
		FIND_LIBRARY(CHOL_DEPS Accelerate)
	ENDIF (APPLE)
	ADD_DEFINITIONS(-DNL_USE_CHOLMOD)
	INCLUDE_DIRECTORIES(${SUITESPARSE_INCLUDE_DIRS})
ENDIF(USE_CHOLMOD)


# creation of the library
IF(USE_CNC)
    IF(WIN32)
	    CUDA_ADD_LIBRARY(nl ${SOURCES} ${HeaderFiles})
    ELSE(WIN32)
        CUDA_ADD_LIBRARY(nl ${SOURCES} )
        set_target_properties(nl PROPERTIES COMPILE_FLAGS "-malign-double")
    ENDIF(WIN32)
    CUDA_ADD_CUBLAS_TO_TARGET(nl)
ELSE(USE_CNC)
    IF(WIN32)
		ADD_LIBRARY(nl ${SOURCES} ${HeaderFiles})
		IF(USE_CHOLMOD)
			TARGET_LINK_LIBRARIES(nl ${SUITESPARSE_LIBRARIES} ${CHOL_DEPS} ${CGoGN_ROOT_DIR}/windows_dependencies/lib/libf2c.lib)
		ENDIF(USE_CHOLMOD)
#		IF(USE_SUPERLU)
#			TARGET_LINK_LIBRARIES(nl ${SUPERLU_LIBRARIES})
#		ENDIF(USE_SUPERLU)
    ELSE(WIN32)
		ADD_LIBRARY(nl ${SOURCES} )
		IF(USE_CHOLMOD)
			TARGET_LINK_LIBRARIES(nl ${SUITESPARSE_LIBRARIES} ${CHOL_DEPS})
		ENDIF(USE_CHOLMOD)
		IF(USE_SUPERLU)
			TARGET_LINK_LIBRARIES(nl ${SUPERLU_LIBRARIES})
		ENDIF(USE_SUPERLU)
    ENDIF(WIN32)
ENDIF(USE_CNC)
install(TARGETS nl
	CONFIGURATIONS Debug
	LIBRARY DESTINATION lib/Debug
	ARCHIVE DESTINATION lib/Debug
	RUNTIME DESTINATION bin/Debug
	)
install(TARGETS nl
	CONFIGURATIONS Release
	LIBRARY DESTINATION lib/Release
	ARCHIVE DESTINATION lib/Release
	RUNTIME DESTINATION bin/Release
	)
